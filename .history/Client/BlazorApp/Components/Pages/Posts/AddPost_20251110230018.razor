@page "/posts/addpost"
@inject IPostService Posts
@inject NavigationManager Nav

<h3>Create Post</h3>

<div style="max-width:600px">
    <div class="mb-2">
        <label>Title</label><br />
        <input @bind="title" placeholder="Post title" />
    </div>

    <div class="mb-2">
        <label>Body</label><br />
        <textarea @bind="body" rows="5" cols="60" placeholder="Post body"></textarea>
    </div>

    <!-- A5: static UserId = 1 (without logging in) -->
    <p><i>UserId is fixed to 1 (A5)</i></p>

    <button @onclick="Create">Create</button>
</div>

@if (!string.IsNullOrWhiteSpace(error))
{
    <p style="color:red">@error</p>
}
@if (!string.IsNullOrWhiteSpace(ok))
{
    <p style="color:green">@ok</p>
    <p><a href="/posts">Go to list</a></p>
}

@code {
    private string? title;
    private string? body;
    private string? error;
    private string? ok;

    private async Task Create()
    {
        error = ok = null;

        if (string.IsNullOrWhiteSpace(title))
        {
            error = "Title is required.";
            return;
        }
        if (string.IsNullOrWhiteSpace(body))
        {
            error = "Body is required.";
            return;
        }

        try
        {
            var dto = new CreatePostDto
            {
                Title = title,
                Body = body,
                UserId = 1 // A5: static UserId = 1
            };

            var created = await Posts.AddPostAsync(dto);
            ok = $"Post created with Id={created.Id}.";
            // After creating, clear the form
            title = body = string.Empty;
        }
        catch (Exception ex)
        {
            error = ex.Message;
        }
    }
}