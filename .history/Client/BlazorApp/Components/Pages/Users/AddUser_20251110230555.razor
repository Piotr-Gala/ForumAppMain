@page "/users/adduser"
@inject IUserService Users

<h3>Create User</h3>

<div style="max-width:600px">
    <div class="mb-2">
        <label>Username</label><br />
        <input @bind="username" placeholder="e.g. martyna" />
    </div>
    <div class="mb-2">
        <label>Password</label><br />
        <input @bind="password" type="password" placeholder="e.g. P@ssw0rd" />
    </div>

    <button @onclick="Create">Create</button>
</div>

@if (!string.IsNullOrWhiteSpace(error))
{
    <p style="color:red">@error</p>
}
@if (!string.IsNullOrWhiteSpace(ok))
{
    <p style="color:green">@ok</p>
}

@code {
    private string? username;
    private string? password;
    private string? error;
    private string? ok;

    private async Task Create()
    {
        error = ok = null;

        if (string.IsNullOrWhiteSpace(username))
        {
            error = "Username is required.";
            return;
        }

        try
        {
            var dto = new CreateUserDto { Username = username, Password = password ?? string.Empty };
            var created = await Users.AddUserAsync(dto);
            ok = $"User created with Id={created.Id}.";
            username = string.Empty;
            password = string.Empty;
        }
        catch (Exception ex)
        {
            error = ex.Message;
        }
    }
}